<!DOCTYPE html>
<html lang="ko"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.1.6 <https://hydejack.com/>
-->







<head>
  






  
    

<title>AWS EC2에서 Nginx와 Certbot으로 Let's encrypt SSL 인증서 발급하기 | NicoDora</title>
<meta name="description" content="AWS EC2 인스턴스에서 Nginx와 Certbot을 사용하여 SSL 인증서를 발급받고 자동갱신까지 설정하는 방법을 다룹니다.
">
<link rel="canonical" href="http://localhost:4000/aws/2025/03/07/AWS-EC2%EC%97%90%EC%84%9C-Nginx%EC%99%80-Certbot%EC%9C%BC%EB%A1%9C-Lets-encrypt-SSL-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%ED%95%98%EA%B8%B0.html">

  

  



  <meta name="theme-color" content="rgb(25,55,71)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="NicoDora">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="NicoDora">

<meta name="generator" content="Hydejack v9.1.6" />


<link rel="alternate" href="http://localhost:4000/aws/2025/03/07/AWS-EC2%EC%97%90%EC%84%9C-Nginx%EC%99%80-Certbot%EC%9C%BC%EB%A1%9C-Lets-encrypt-SSL-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%ED%95%98%EA%B8%B0.html" hreflang="ko">



<link rel="shortcut icon"    href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">

<link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com">


  <link rel="dns-prefetch" href="https://www.google-analytics.com">


<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">
  <link rel="dns-prefetch" href="/assets/js/search-worker-9.1.6.js" as="worker" id="_hrefSearch">






<script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2025-03-07T14:50:15+09:00',
  };
  w._clapButton = true;
}(window);</script>



<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload">



  <style id="_pageStyle">

html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79, 177, 186, 0.5);--accent-color-highlight: rgba(79, 177, 186, 0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(25,55,71);--dark-mode-body-bg: hsl(200.8695652174, 5.9895833333%, 17.5%);--dark-mode-border-color: hsl(200.8695652174, 5.9895833333%, 22.5%)}
</style>


<!--<![endif]-->




<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="/assets/js/sidebar-folder.js"></script>


  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D9VF7EQWGG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-D9VF7EQWGG');
</script>
</head>

<body class="dark-mode no-break-layout">
  
<script>
  window._sunrise = 6;
  window._sunset =  18;
  !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(e=(a=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(a),s.body.classList.remove(e))}(window,document);

</script>



<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/aws/">aws</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/aws/2025/">2025</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/aws/2025/03/">03</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/aws/2025/03/07/">07</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기.html</span>
        
      </li>
    
  
</ul></nav>
  










<article id="post-aws-2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        AWS EC2에서 Nginx와 Certbot으로 Let's encrypt SSL 인증서 발급하기
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2025-03-07T14:31:00+09:00">2025-03-07 14:31</time> in <a href="/aws/" class="flip-title">AWS</a> 
      </span>
      
        
      
    </div>

    
    
      
        <div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img">
          


<img
  
    src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/letsencrypt-logo.png"
  
  alt="AWS EC2에서 Nginx와 Certbot으로 Let's encrypt SSL 인증서 발급하기"
  
  
  width="864"
  height="486"
  loading="lazy"
/>

        </div>
      
      
    

    



  
    <p class="note-sm" >
      AWS EC2 인스턴스에서 Nginx와 Certbot을 사용하여 SSL 인증서를 발급받고 자동갱신까지 설정하는 방법을 다룹니다.

    </p>
  


  </header>

  
    <ol id="markdown-toc">
  <li><a href="#들어가기-전에" id="markdown-toc-들어가기-전에">들어가기 전에</a></li>
  <li><a href="#사전-준비-환경" id="markdown-toc-사전-준비-환경">사전 준비 환경</a></li>
  <li><a href="#dns-체크" id="markdown-toc-dns-체크">DNS 체크</a></li>
  <li><a href="#docker-composeyaml-작성" id="markdown-toc-docker-composeyaml-작성">docker-compose.yaml 작성</a></li>
  <li><a href="#nginxconf-파일-작성" id="markdown-toc-nginxconf-파일-작성">nginx.conf 파일 작성</a></li>
  <li><a href="#nginx-임시-실행" id="markdown-toc-nginx-임시-실행">Nginx 임시 실행</a></li>
  <li><a href="#certbot으로-ssl-인증서-발급" id="markdown-toc-certbot으로-ssl-인증서-발급">Certbot으로 SSL 인증서 발급</a></li>
  <li><a href="#docker-composeyaml-파일-업데이트" id="markdown-toc-docker-composeyaml-파일-업데이트">docker-compose.yaml 파일 업데이트</a></li>
  <li><a href="#nginxconf-파일-업데이트" id="markdown-toc-nginxconf-파일-업데이트">nginx.conf 파일 업데이트</a></li>
  <li><a href="#docker-compose-실행" id="markdown-toc-docker-compose-실행">docker-compose 실행</a></li>
  <li><a href="#마치며" id="markdown-toc-마치며">마치며</a></li>
</ol>

<h2 id="들어가기-전에">들어가기 전에</h2>

<p>프로젝트를 진행중에 백엔드 개발서버를 배포해야 할 상황이 와서 급하게 EC2와 RDS를 만들고 SSL 인증서를 발급받으려고 할 때 갑자기 이런 생각이 들었습니다. <b>“이거 블로그에 정리해두면 좋겠다!”</b> 라고…
<br />
<br />
백엔드 서버의 배포과정을 A to Z로 정리하면 좋겠지만…<br />
이미 AWS 세팅은 대부분 완료된 상태라서, SSL 인증서 발급과정만 정리해보려고 합니다.
<br />
<br />
사실 SSL 인증서 발급 부분도 처음 적용하는 사람 입장에서는 헷갈릴 수 있는 부분이 많아서, 블로그에 정리해두면 분명 다른 사람들에게 도움이 될 거라고 생각합니다! (실제로 저도 처음에는 많이 헤맸거든요… ㅎㅎ;;)</p>

<h2 id="사전-준비-환경">사전 준비 환경</h2>

<p>일단 저의 환경은 아래와 같습니다.
<br />
<br />
<img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/dev-server-architecture1.png" alt="dev 서버 아키텍쳐1" /></p>

<ul>
  <li>AWS EC2 인스턴스 (Ubuntu)</li>
  <li>도메인 구매 및 연결 (가비아, AWS Route53)</li>
  <li>EC2에서 Docker로 백엔드 서버 실행
<br />
<br />
<br />
해당 환경을 다음과 같이 수정해보려 합니다.
<br />
<br />
<img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/dev-server-architecture2.png" alt="dev 서버 아키텍쳐2" /></li>
</ul>

<p><br />
여기서 도메인 구매는 필수가 아니기 때문에 EC2 인스턴스에 할당된 퍼블릭 IPv4 주소를 사용해도 괜찮지만, 저는 도메인을 구매했기 때문에 도메인을 사용해서 진행하겠습니다.
<br />
<br />
Docker를 사용하지 않고 EC2 인스턴스에 Nginx를 설치하고 SSL 인증서를 발급받는 방법도 있지만, Docker를 사용하면 더 간편하게 관리할 수 있기 때문에 저는 Docker 사용을 추천드립니다.
<br />
<br />
EC2 인스턴스에 Docker 및 docker-compose 설치는 아래 명령어를 차례대로 입력하시면 됩니다.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1-1. 프로그램 설치 전 우분투 시스템 패키지 업데이트</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get update

<span class="c"># 1-2. 필요한 패키지 설치</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>apt-transport-https ca-certificates curl gnupg-agent software-properties-common

<span class="c"># 1-3. Docker의 공식 GPG 키 추가</span>
<span class="nv">$ </span>curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>apt-key add -

<span class="c"># 1-4. Docker의 공식 apt 저장소 추가</span>
<span class="nv">$ </span><span class="nb">sudo </span>add-apt-repository <span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="si">$(</span>lsb_release <span class="nt">-cs</span><span class="si">)</span><span class="s2"> stable"</span>

<span class="c"># 1-5. 시스템 패키지 업데이트</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get update

<span class="c"># 1-6. Docker 설치</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>docker-ce docker-ce-cli containerd.io

<span class="c"># 2-1. Docker Compose 설치</span>
<span class="nv">$ </span><span class="nb">sudo </span>curl <span class="nt">-L</span> <span class="s2">"https://github.com/docker/compose/releases/download/1.27.4/docker-compose-</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-s</span><span class="si">)</span><span class="s2">-</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span><span class="s2">"</span> <span class="nt">-o</span> /usr/local/bin/docker-compose

<span class="c"># 2-2. 다운로드 한 파일에 권한 설정</span>
<span class="nv">$ </span><span class="nb">sudo chmod</span> +x /usr/local/bin/docker-compose

<span class="c"># 2-3. Docker Compose 버전 확인 (정상적으로 설치되었는지 확인)</span>
<span class="nv">$ </span>docker-compose <span class="nt">--version</span>
</code></pre></div></div>

<p><a href="https://velog.io/@jjeongdong/Devops-Docker-Compose%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-EC2%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EB%B0%B0%ED%8F%AC#ec2-linux%EC%97%90-docker--docker-compose-%EC%84%A4%EC%B9%98">출처</a></p>

<h2 id="dns-체크">DNS 체크</h2>

<p>도메인을 구매하신 분들이라면 DNS가 정상적으로 설정되었는지 확인해보셔야 합니다.<br />
터미널에서 아래 명령어를 입력하시면 됩니다.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dig {도메인}</span>
<span class="nv">$ </span>dig dev.honeymoa.kr
</code></pre></div></div>

<p>정상적으로 설정되었다면 아래와 같이 <code class="language-plaintext highlighter-rouge">status</code>가 <code class="language-plaintext highlighter-rouge">NOERROR</code>로 나오고, <code class="language-plaintext highlighter-rouge">ANSWER SECTION</code>에 도메인과 연결된 IP 주소가 나옵니다.
<img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/dns-check.png" alt="DNS 설정 확인" />
<br />
<br />
혹시나 <code class="language-plaintext highlighter-rouge">status</code>가 <code class="language-plaintext highlighter-rouge">NXDOMAIN</code>으로 나오신다면 도메인 설정이 잘못되었거나, DNS 서버에 도메인 정보가 전파되지 않은 것입니다.<br />
다시한번 도메인 설정을 확인하시고, 올바르게 설정하셨다면 DNS 서버에 도메인 정보가 전파될 때까지 기다려주세요.</p>

<h2 id="docker-composeyaml-작성">docker-compose.yaml 작성</h2>

<p><span style="color:#808080"> 📍 <em>지금부터 파일 작성은 EC2 인스턴스에 접속했을 때의 <b>루트 디렉토리(/home/ubuntu)</b>에서 진행되니 유의해주세요!</em> </span></p>

<p>레거시한 방법으로 SSL 인증서를 발급하려면 EC2 인스턴스에 Nginx를 설치하고, Certbot을 설치해야 하지만,<br />
Docker를 사용하면 Nginx와 Certbot을 컨테이너로 한번에 실행할 수 있습니다.
<br />
<br />
아래와 같이 <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> 파일을 작성해줍니다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># file: "docker-compose.yaml"</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.7'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.15-alpine</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">80:80'</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx/nginx.conf:/etc/nginx/nginx.conf</span>
      <span class="pi">-</span> <span class="s">./nginx/www/certbot:/var/www/certbot</span>
      <span class="pi">-</span> <span class="s">./nginx/logs:/var/log/nginx</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="na">certbot</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">certbot/certbot</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">certbot</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx/www/certbot:/var/www/certbot</span>
      <span class="pi">-</span> <span class="s">./nginx/ssl:/etc/letsencrypt</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">certonly --webroot --webroot-path=/var/www/certbot -d {도메인}</span>
</code></pre></div></div>
<p><br />
간단하게 위 코드에 대해서 설명드리겠습니다.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">nginx</code> 서비스
    <ul>
      <li><code class="language-plaintext highlighter-rouge">image</code>: 사용할 Nginx 이미지</li>
      <li><code class="language-plaintext highlighter-rouge">container_name</code>: 컨테이너 이름</li>
      <li><code class="language-plaintext highlighter-rouge">ports</code>: 호스트와 컨테이너의 포트 매핑 (80:80)</li>
      <li><code class="language-plaintext highlighter-rouge">volumes</code>: 호스트와 컨테이너의 디렉토리 매핑</li>
      <li><code class="language-plaintext highlighter-rouge">restart</code>: 컨테이너가 중지되었을 때 재시작할 정책 설정</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">certbot</code> 서비스
    <ul>
      <li><code class="language-plaintext highlighter-rouge">image</code>: 사용할 Certbot 이미지</li>
      <li><code class="language-plaintext highlighter-rouge">container_name</code>: 컨테이너 이름</li>
      <li><code class="language-plaintext highlighter-rouge">volumes</code>: 호스트와 컨테이너의 디렉토리 매핑</li>
      <li><code class="language-plaintext highlighter-rouge">command</code>: Certbot 명령어 (인증서 발급)
<br />
<br /></li>
    </ul>
  </li>
</ul>

<h2 id="nginxconf-파일-작성">nginx.conf 파일 작성</h2>

<p><code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> 파일에서 볼륨 마운트 설정을 보면 <code class="language-plaintext highlighter-rouge">nginx/</code> 디렉토리가 필요한 것을 확인할 수 있습니다.
<br /></p>

<p class="note">전체적인 디렉토리 구조는 아래와 같습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/ubuntu
├── docker-compose.yaml
├── nginx
│   ├── nginx.conf
│   ├── ssl/
│   │   ├── (certbot 인증서)
│   ├── logs/
│   └── www/
│       └── certbot/
└── .env
</code></pre></div></div>
<p><br /></p>

<p>아래와 같이 <b><code class="language-plaintext highlighter-rouge">nginx</code></b> 디렉토리를 생성해줍니다.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>nginx
</code></pre></div></div>

<p><br />
그리고 <code class="language-plaintext highlighter-rouge">nginx</code> 디렉토리 안에 <b><code class="language-plaintext highlighter-rouge">nginx.conf</code></b> 파일을 생성해줍니다.<br />
<code class="language-plaintext highlighter-rouge">nginx.conf</code> 파일은 Nginx가 실행될 때 사용하는 설정 파일로, 아래와 같이 작성해줍니다.</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># file: "nginx/nginx.conf"</span>
<span class="k">events</span> <span class="p">{</span>
  <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">http</span> <span class="p">{</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">dev.honeymoa.kr</span><span class="p">;</span> <span class="c1"># server_name {도메인}</span>

    <span class="kn">location</span> <span class="n">/.well-known/acme-challenge/</span> <span class="p">{</span>
      <span class="kn">root</span> <span class="n">/var/www/certbot</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
      <span class="kn">return</span> <span class="mi">404</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<details>
<summary><b>nginx.conf 파일 설명</b></summary>
<div>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">events</code> 블록에서는 Nginx 작업자가 동시에 처리할 수 있는 최대 연결 수를 설정합니다. 여기서 <code class="language-plaintext highlighter-rouge">worker_connections 1024;</code>는 각각의 작업자가 최대 1024개의 연결을 동시에 처리할 수 있도록 지정합니다.</p>
      </li>
      <li>
        <p>다음으로, <code class="language-plaintext highlighter-rouge">http</code> 블록 내부에 정의된 <code class="language-plaintext highlighter-rouge">server</code> 블록은 80번 포트를 리스닝하며, 도메인에 대한 요청을 처리합니다.</p>
        <ul>
          <li>첫 번째 <code class="language-plaintext highlighter-rouge">location</code> 블록은 <code class="language-plaintext highlighter-rouge">/.well-known/acme-challenge/</code>경로에 대한 요청을 처리합니다. 여기서는 해당 경로의 요청에 대해 <code class="language-plaintext highlighter-rouge">/var/www/certbot</code> 디렉토리에서 파일을 제공하도록 설정되어 있습니다.</li>
          <li>두 번째 location 블록은 <code class="language-plaintext highlighter-rouge">/</code>로 시작하는 모든 다른 요청에 대해 404 응답을 반환합니다. 인증서 발급 관련 요청 외의 다른 접근을 차단하기 위한 설정입니다.</li>
        </ul>
      </li>
    </ul>
  </div>
</details>
<p><br /></p>

<p>나머지 <code class="language-plaintext highlighter-rouge">/nginx/www/</code>, <code class="language-plaintext highlighter-rouge">/nginx/logs/</code>, <code class="language-plaintext highlighter-rouge">/nginx/ssl/</code> 디렉토리는 Nginx 실행 시 자동으로 생성되기 때문에 수동으로 생성할 필요는 없습니다.</p>

<h2 id="nginx-임시-실행">Nginx 임시 실행</h2>

<p><code class="language-plaintext highlighter-rouge">nginx.conf</code> 파일 작성이 완료되었으므로 이제 Nginx를 실행해보겠습니다.
<br />
<br /></p>

<p><code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> 파일이 있는 디렉토리에서 아래 명령어를 입력하여 Nginx를 실행합니다.<br />
<span style="color:#808080"><em>(만약 <code class="language-plaintext highlighter-rouge">docker-compose</code> 파일의 이름이 다르다면 <code class="language-plaintext highlighter-rouge">-f</code> 옵션을 사용하여 파일 이름을 지정해주셔야 합니다.)</em></span></p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose up <span class="nt">-d</span> nginx
</code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/nginx-up.png" alt="nginx 실행" /></p>

<p><br />
컨테이너가 정상적으로 실행되었는지 확인합니다.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 로그가 없어야 정상적으로 실행된 것입니다.</span>
<span class="nv">$ </span>docker logs nginx

<span class="c"># nginx.conf 파일 문법 검사</span>
<span class="nv">$ </span>docker-compose <span class="nb">exec </span>nginx nginx <span class="nt">-t</span>

<span class="c"># nginx가 실행중인지 확인</span>
<span class="nv">$ </span>docker ps
</code></pre></div></div>

<p><img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/nginx-check.png" alt="nginx 실행 확인" />
<br /></p>

<h2 id="certbot으로-ssl-인증서-발급">Certbot으로 SSL 인증서 발급</h2>

<p>이제 Nginx가 실행되었으니 Certbot을 사용하여 SSL 인증서를 발급받아보겠습니다.<br />
1️⃣ <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> 파일이 있는 디렉토리에서 아래 명령어를 입력하여 Certbot 컨테이너를 실행합니다.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose run <span class="nt">--rm</span> certbot
</code></pre></div></div>
<p><br />
2️⃣ 긴급 갱신 및 보안 알림에 사용할 이메일 주소를 입력하라고 나오니 적절한 이메일 주소를 입력해줍니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log
Enter email address (used for urgent renewal and security notices)
 (Enter 'c' to cancel):
</code></pre></div></div>
<p><br />
3️⃣ 약관에 동의하라는 메시지가 나오는데, 약관에 동의해야 인증서 발급이 되니 <code class="language-plaintext highlighter-rouge">Y</code>를 입력해줍니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Please read the Terms of Service at:
https://letsencrypt.org/documents/LE-SA-v1.5-February-24-2025.pdf
You must agree in order to register with the ACME server. Do you agree?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: Y
</code></pre></div></div>
<p><br />
4️⃣ 홍보성 메일 수신 여부를 묻는 메시지가 나오는데, 원하시는 대로 선택하시면 됩니다.<br />
저는 메일 수신을 원하지 않아서 <code class="language-plaintext highlighter-rouge">N</code>을 입력했습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Would you be willing, once your first certificate is successfully issued, to
share your email address with the Electronic Frontier Foundation, a founding
partner of the Let's Encrypt project and the non-profit organization that
develops Certbot? We'd like to send you email about our work encrypting the web,
EFF news, campaigns, and ways to support digital freedom.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: N
</code></pre></div></div>
<p><br />
📍 <span style="color:#F08080">아래와 같은 에러가 발생한다면 AWS 보안 그룹에서 <code class="language-plaintext highlighter-rouge">80</code>번 포트가 열려있는지 확인해주세요!</span></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Account registered.
Requesting a certificate for dev.honeymoa.kr

Certbot failed to authenticate some domains (authenticator: webroot). The Certificate Authority reported these problems:
  Domain: dev.honeymoa.kr
  Type:   connection
  Detail: 3.39.69.185: Fetching http://dev.honeymoa.kr/.well-known/acme-challenge/SLl0wrWe_5cmAZN6XAX0zq8kboOBEETuiT5WcMvSrtM: Timeout during connect (likely firewall problem)

Hint: The Certificate Authority failed to download the temporary challenge files created by Certbot. Ensure that the listed domains serve their content from the provided --webroot-path/-w and that files created there can be downloaded from the internet.

Some challenges have failed.
Ask for help or search for solutions at https://community.letsencrypt.org. See the logfile /var/log/letsencrypt/letsencrypt.log or re-run Certbot with -v for more details.
</code></pre></div></div>
<p><br />
5️⃣ <span style="color:#32CD32">인증서 발급이 완료되면 아래와 같은 메시지가 출력됩니다.</span></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Requesting a certificate for dev.honeymoa.kr

Successfully received certificate.
Certificate is saved at: /etc/letsencrypt/live/dev.honeymoa.kr/fullchain.pem
Key is saved at:         /etc/letsencrypt/live/dev.honeymoa.kr/privkey.pem
This certificate expires on 2025-06-04.
These files will be updated when the certificate renews.

NEXT STEPS:
- The certificate will need to be renewed before it expires. Certbot can automatically renew the certificate in the background, but you may need to take steps to enable that functionality. See https://certbot.org/renewal-setup for instructions.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
If you like Certbot, please consider supporting our work by:
 * Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
 * Donating to EFF:                    https://eff.org/donate-le
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</code></pre></div></div>
<p><br />
인증서 발급에 성공하면 <b><code class="language-plaintext highlighter-rouge">/nginx/ssl/live/{도메인}/</code></b> 디렉토리 안에 인증서와 개인키가 저장됩니다.<br />
인증서와 개인키는 각각 <b><code class="language-plaintext highlighter-rouge">fullchain.pem</code></b>과 <b><code class="language-plaintext highlighter-rouge">privkey.pem</code></b> 파일에 저장됩니다.
<br />
<br />
인증서와 개인키가 정상적으로 발급되었는지 확인하고 싶다면 아래 명령어를 입력하시면 됩니다.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 인증서 확인</span>
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /nginx/ssl/live/<span class="o">{</span>도메인<span class="o">}</span>
</code></pre></div></div>
<p><img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/cert-check.png" alt="인증서 확인" />
<br /></p>

<h2 id="docker-composeyaml-파일-업데이트">docker-compose.yaml 파일 업데이트</h2>

<p>인증서 발급이 완료되었으니 아래 명령어를 입력하여 Nginx를 종료합니다.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose down
</code></pre></div></div>
<p><img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/nginx-down.png" alt="nginx 종료" />
<br />
<br />
이제 <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> 파일을 완성해봅시다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># file: "docker-compose.yaml"</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">honey-moa-dev</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nicodora/honey-moa-dev:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">honey-moa-dev</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">3000:3000'</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">honey-moa-dev-network</span>

  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.15-alpine</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">80:80'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">443:443'</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx/nginx.conf:/etc/nginx/nginx.conf</span> <span class="c1"># nginx.conf 파일</span>
      <span class="pi">-</span> <span class="s">./nginx/www/certbot:/var/www/certbot</span> <span class="c1"># certbot이 사용할 디렉토리</span>
      <span class="pi">-</span> <span class="s">./nginx/ssl:/etc/letsencrypt</span> <span class="c1"># ssl 인증서 저장 디렉토리</span>
      <span class="pi">-</span> <span class="s">./nginx/logs:/var/log/nginx</span> <span class="c1"># nginx 로그 저장 디렉토리</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">honey-moa-dev</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">honey-moa-dev-network</span>

  <span class="na">certbot</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">certbot/certbot</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">certbot</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx/www/certbot:/var/www/certbot</span> <span class="c1"># certbot이 사용할 디렉토리</span>
      <span class="pi">-</span> <span class="s">./nginx/ssl:/etc/letsencrypt</span> <span class="c1"># ssl 인증서 저장 디렉토리</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/bin/sh</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">'trap</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">TERM;</span><span class="nv"> </span><span class="s">while</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">certbot</span><span class="nv"> </span><span class="s">renew;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">12h</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">$${!};</span><span class="nv"> </span><span class="s">done;'"</span> <span class="c1"># 인증서 자동 갱신</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">honey-moa-dev-network</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">honey-moa-dev-network</span><span class="pi">:</span> <span class="c1"># 네트워크 설정</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</code></pre></div></div>

<details>
<summary><b>docker-compose.yaml 파일 설명</b></summary>
<div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> 파일에서 <code class="language-plaintext highlighter-rouge">honey-moa-dev</code>(백엔드 서버), <code class="language-plaintext highlighter-rouge">nginx</code>, <code class="language-plaintext highlighter-rouge">certbot</code> 을 정의합니다.</li>
      <li>nginx 서비스는 80번과 443번 포트를 리스닝하고, 볼륨 마운트를 통해 nginx.conf 파일과 인증서, 로그 디렉토리를 연결합니다.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">depends_on:</code> 옵션을 사용하여 Nginx가 백엔드 서버에 의존하도록 설정하여 백엔드 서버가 실행된 후에 시작됩니다.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">certbot</code> 서비스는 <code class="language-plaintext highlighter-rouge">entrypoint</code>를 사용하여 Certbot이 12시간마다 인증서를 갱신하도록 설정했습니다.</li>
      <li><code class="language-plaintext highlighter-rouge">networks:</code> 옵션을 사용하여 <code class="language-plaintext highlighter-rouge">honey-moa-dev-network</code>라는 네트워크를 생성하고, 모든 서비스가 이 네트워크를 사용하도록 설정했습니다.</li>
    </ul>
  </div>
</details>

<h2 id="nginxconf-파일-업데이트">nginx.conf 파일 업데이트</h2>

<p>인증서 발급이 완료되었으므로 요청을 <code class="language-plaintext highlighter-rouge">HTTPS</code>로 받을 수 있도록 <code class="language-plaintext highlighter-rouge">nginx.conf</code> 파일도 업데이트 해줍니다.</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># file: "nginx/nginx.conf"</span>
<span class="k">events</span> <span class="p">{</span>
  <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span> <span class="c1"># 워커 프로세스가 처리할 수 있는 최대 연결 수</span>
<span class="p">}</span>

<span class="k">http</span> <span class="p">{</span>
  <span class="kn">upstream</span> <span class="s">backend</span> <span class="p">{</span>
      <span class="kn">server</span> <span class="nf">honey-moa-dev</span><span class="p">:</span><span class="mi">3000</span><span class="p">;</span> <span class="c1"># 백엔드 컨테이너 연결</span>
  <span class="p">}</span>

  <span class="c1"># HTTPS 설정</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">dev.honeymoa.kr</span><span class="p">;</span> <span class="c1"># server_name {도메인}</span>

    <span class="kn">ssl_certificate</span> <span class="n">/etc/letsencrypt/live/dev.honeymoa.kr/fullchain.pem</span><span class="p">;</span> <span class="c1"># SSL 인증서 경로</span>
    <span class="kn">ssl_certificate_key</span> <span class="n">/etc/letsencrypt/live/dev.honeymoa.kr/privkey.pem</span><span class="p">;</span> <span class="c1"># SSL 개인키 경로</span>

    <span class="kn">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
    <span class="kn">ssl_ciphers</span> <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
      <span class="kn">proxy_pass</span> <span class="s">http://backend</span><span class="p">;</span>
      <span class="kn">proxy_http_version</span> <span class="mf">1.1</span><span class="p">;</span>
      <span class="kn">proxy_set_header</span> <span class="s">Upgrade</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
      <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">'upgrade'</span><span class="p">;</span>
      <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
      <span class="kn">proxy_cache_bypass</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1"># HTTP -&gt; HTTPS 리디렉션 설정</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">dev.honeymoa.kr</span><span class="p">;</span> <span class="c1"># server_name {도메인}</span>

    <span class="kn">location</span> <span class="n">/.well-known/acme-challenge/</span> <span class="p">{</span>
      <span class="kn">root</span> <span class="n">/var/www/certbot</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<details>
<summary><b>nginx.conf 파일 설명</b></summary>
<div>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">upstream backend</code> 블록은 백엔드 서버의 주소를 설정합니다.
        <ul>
          <li>여기서는 <code class="language-plaintext highlighter-rouge">honey-moa-dev:3000</code>으로 설정하여 <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code>에서 정의했던 서비스 이름을 사용합니다.</li>
        </ul>
      </li>
      <li>첫번째 <code class="language-plaintext highlighter-rouge">server</code> 블록은 HTTPS 요청을 처리합니다.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">listen 443 ssl;</code>은 443번 포트를 SSL로 리스닝하도록 설정합니다.</li>
          <li><code class="language-plaintext highlighter-rouge">ssl_certificate</code>와 <code class="language-plaintext highlighter-rouge">ssl_certificate_key</code>는 발급받은 SSL 인증서와 개인키의 경로를 설정합니다.</li>
          <li><code class="language-plaintext highlighter-rouge">ssl_protocols</code>와 <code class="language-plaintext highlighter-rouge">ssl_ciphers</code>는 SSL 프로토콜과 암호화 방식을 설정합니다.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">location /</code> 블록은 모든 요청을 백엔드 서버로 프록시 패스합니다.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">proxy_pass</code>는 요청을 백엔드 서버로 전달합니다.</li>
          <li><code class="language-plaintext highlighter-rouge">proxy_set_header</code>는 요청 헤더를 설정하여 클라이언트의 정보를 백엔드 서버에 전달합니다.</li>
        </ul>
      </li>
      <li>두번째 <code class="language-plaintext highlighter-rouge">server</code> 블록은 HTTP 요청을 HTTPS로 리디렉션합니다.</li>
    </ul>
  </div>
</details>

<h2 id="docker-compose-실행">docker-compose 실행</h2>
<p>이제 모든 설정이 완료되었으니 아래 명령어를 입력하여 컨테이너를 실행해봅시다!</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose up <span class="nt">-d</span>
</code></pre></div></div>
<p><img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/docker-compose-up.png" alt="docker-compose 실행" />
<br /></p>

<p><code class="language-plaintext highlighter-rouge">Nginx</code> 컨테이너가 정상적으로 실행되었는지 확인:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nginx.conf 파일 문법 검사</span>
<span class="nv">$ </span>docker-compose <span class="nb">exec </span>nginx nginx <span class="nt">-t</span>

<span class="c"># HTTPS 요청 확인</span>
<span class="c"># curl -I https://{도메인}</span>
<span class="nv">$ </span>curl <span class="nt">-I</span> https://dev.honeymoa.kr
</code></pre></div></div>
<p><img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/docker-compose-nginx-check.png" alt="docker-compose nginx 실행 확인" />
<br /></p>

<p><code class="language-plaintext highlighter-rouge">Certbot</code> 컨테이너가 정상적으로 실행되었는지 확인:</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># certbot 컨테이너 실행 확인</span>
<span class="nv">$ </span>docker logs certbot
</code></pre></div></div>
<p><img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/aws/2025-03-07-AWS-EC2에서-Nginx와-Certbot으로-Lets-encrypt-SSL-인증서-발급하기/docker-compose-certbot-check.png" alt="docker-compose certbot 실행 확인" />
<br /></p>

<p>각 컨테이너들의 실행 확인까지 마치셨다면 SSL 인증서 적용 후, Certbot을 이용한 자동 갱신까지 완성입니다! 🎉</p>

<h2 id="마치며">마치며</h2>

<p>오늘은 AWS EC2 인스턴스에서 Nginx와 Certbot을 사용하여 SSL 인증서를 발급받고 자동갱신까지 설정하는 방법을 알아보았습니다.
처음 SSL 인증서를 발급받는 과정을 접한다면 생소하고, 특히 <code class="language-plaintext highlighter-rouge">nginx.conf</code> 파일과 <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code> 파일을 작성하는 부분에서 어려움을 느끼실 수 있는데요. 조급해 하지 말고 차근차근 각 단계에 대해 알아보고 여러번 적용해보면 금방 익숙해질 수 있을겁니다.</p>

<p>그럼 다음 포스트에서 뵙겠습니다! 뾰로롱~
<br />
<br />
<img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/frieren1.gif" width="300" height="300" alt="프리렌 움짤1" /></p>

  
</article>



  <hr class="dingbat related mb6" />


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D9VF7EQWGG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-D9VF7EQWGG');
</script>




  
     



  

  
  

  
    


  <aside class="related mb4" role="complementary">  <h2 class="hr-bottom">Related Posts</h2>  <ul class="related-posts">                  <li class="h4">  <a href="/docker/2024/04/03/Docker-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0-for-macOS.html" class="flip-title"><span>Docker 설치하기 for macOS</span></a>  <time class="faded fine" datetime="2024-04-03T15:50:00+09:00">2024-04-03 15:50</time></li>                        <li class="h4">  <a href="/nestjs/2024/03/29/NestJS-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0.html" class="flip-title"><span>NestJS 설치 및 시작하기</span></a>  <time class="faded fine" datetime="2024-03-29T09:57:00+09:00">2024-03-29 09:57</time></li>                        <li class="h4">  <a href="/nestjs/2024/03/22/NestJS%EB%A5%BC-%EC%84%A0%ED%83%9D%ED%95%9C-%EC%9D%B4%EC%9C%A0.html" class="flip-title"><span>NestJS를 선택한 이유 (NestJS란?)</span></a>  <time class="faded fine" datetime="2024-03-22T21:20:00+09:00">2024-03-22 21:20</time></li>            </ul></aside>

  

  
  

  
    
<aside class="comments related" role="complementary">
  <h2 class="hr-bottom">Comments</h2>
  <!-- 
 -->
<script src="https://giscus.app/client.js"
        data-repo="NicoDora/NicoDora.github.io"
        data-repo-id="R_kgDOLeHHqA"
        data-category="Comments"
        data-category-id="DIC_kwDOLeHHqM4CeGWL"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="dark_dimmed"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</aside>


  

  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">© 2024 NicoDora. All rights reserved.
</small></p>
  
  
    <p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.1.6</span></small></p>
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/sidebar-bg.jpg)"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="https://cdn.jsdelivr.net/gh/NicoDora/nicodora.github.io/assets/img/logo.png" class="avatar" alt="NicoDora" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h2">NicoDora</h2></a>
    
    
      <p class="">
        keep moving

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/"
          class="sidebar-nav-item "
          
        >
          Home
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/nestjs/"
          class="sidebar-nav-item "
          
        >
          NestJS
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/aws/"
          class="sidebar-nav-item "
          
        >
          AWS
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/docker/"
          class="sidebar-nav-item "
          
        >
          Docker
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social</span>
<ul>
  
    
    

    
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/NicoDora" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    

    
    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}();
</script>
  <script src="/assets/js/hydejack-9.1.6.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script>
  

  
  <script>!function(w, d) {
    w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;

    /**/
      if (navigator.CookiesOK) {
        ga('create', 'G-D9VF7EQWGG', 'auto');
      } else if (d.cookie.indexOf("hy--cookies-ok=true") > -1) {
        ga('create', 'G-D9VF7EQWGG', {
          'storage': 'none',
          'clientId': localStorage ? localStorage.getItem('ga--client-id') : undefined
        });
      } else {
        ga('create', 'G-D9VF7EQWGG', {
          'storage': 'none'
        });
        ga('set', 'forceSSL', true);
        ga('set', 'anonymizeIp', true);
      }
    /**/

    var pushStateEl = d.getElementById('_pushState');
    var timeoutId;
    pushStateEl.addEventListener('hy-push-state-load', function() {
      w.clearTimeout(timeoutId);
      timeoutId = w.setTimeout(function() {
        ga('set', 'page', w.location.pathname);
        ga('send', 'pageview');
      }, 500);
    });

    d.addEventListener('hy--cookies-ok', function () {
      w.ga(function(tracker) {
        w.ga("set", "anonymizeIp", undefined);
        localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId"));
      });
    });

    w.loadJSDeferred('https://www.google-analytics.com/analytics.js');
  }(window, document);</script>


<!--<![endif]-->
  



<div hidden>
  
  <h2 class="sr-only">Templates:</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h2 class="page-title">Error</h2>
    
    
    <p class="lead">
      Sorry, an error occurred while loading: <a class="this-link" href=""></a>.
    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

  
    <template id="_cookies-banner-template">
  <div id="_cookies-banner" class="navbar fixed-bottom CookiesOK">
    <div class="content">
      <div class="nav-btn-bar">
        <small class="faded">
          <span>This site uses cookies.
</span>
          <button id="_cookies-ok" class="btn btn-primary btn-sm">Okay</button>
        </small>
      </div>
    </div>
  </div>
</template>

  
  
    <template id="_dark-mode-template">
  <button id="_dark-mode" class="nav-btn no-hover" >
    <span class="sr-only">Dark Mode</span>
    <span class="icon-brightness-contrast"></span>
  </button>
</template>

  
  
    <template id="_search-template">
  <button id="_search" class="nav-btn no-hover">
    <label class="sr-only" for="_search-input">Search</label>
    <span class="icon-search"></span>
  </button>
  <div id="_search-box">
    <div class="nav-btn">
      <span class="icon-search"></span>
    </div>
    <input
      id="_search-input"
      type="search"
      class="form-control form-control-lg nav-btn"
      placeholder="Build with JEKYLL_ENV=production to enable search."
    />
    <button type="reset" class="nav-btn no-hover">
      <span class="sr-only">Close</span>
      <span class="icon-cross"></span>
    </button>
  </div>
  <div id="_hits"></div>
</template>

  
</div>


</body>
</html>
